{% extends "base.html" %}

{% block head %}
{{ super() }}
{% endblock %}

{% block content %}
<div class="order-container" data-order-id="{{ order_id }}" data-aps-id="{{ aps_id }}">
    <!-- Górna sekcja -->
    <header class="order-top-section">
        <div class="order-logo-section">
            <img src="{{ url_for('static', filename='images/MunchiesLogoPlain.svg') }}" alt="Munchies Logo" class="order-logo">
        </div>
        <div class="order-flags-section">
            <div class="order-flags">
                <button class="order-flag-button">
                    <img src="{{ url_for('static', filename='images/plFlag.png') }}" alt="pl" class="order-flag-icon">
                </button>
                <button class="order-flag-button">
                    <img src="{{ url_for('static', filename='images/angFlag.png') }}" alt="en" class="order-flag-icon">
                </button>
                <button class="order-flag-button">
                    <img src="{{ url_for('static', filename='images/uaFlag.png') }}" alt="uk" class="order-flag-icon">
                </button>
            </div>
            <p class="order-estimated-time">
                {{ _('Estimated waiting time: %(time)d min', time=estimated_waiting_time) }}
            </p>
        </div>
    </header>

    <!-- Środkowa sekcja -->
    <main class="order-middle-section">
        <!-- Pasek kategorii -->
        <nav class="order-category-bar">
            {% set categories = [
                ('snack', _('Snacks')),
                ('drink', _('Drinks')),
                ('coffee', _('Coffee')),
                ('take_away_box', _('Take Away')),
                ('sauce', _('Sauces')),
                ('sum', _('Summary'))
            ] %}
            {% for category_id, category_name in categories %}
                <button class="order-category-button {% if loop.first %}active{% endif %}" data-category="{{ category_id }}">
                    {{ category_name }}
                </button>
            {% endfor %}
        </nav>

        <!-- Lista produktów -->
        <div class="order-product-list">
            {% for item in menu_items %}
                {# Mapowanie kodów języków #}
                {% set lang_code = 'ua' if session.get('language') == 'uk' else session.get('language', 'pl') %}
                <article class="order-product-item" data-category="{{ item.category.value }}" data-item-id="{{ item.item_id }}">
                    <div class="order-product-image-container">
                        <img src="" 
                             data-image-filename="{{ item.image }}"
                             alt="{{ item['name_' + lang_code] }}" 
                             class="order-product-image"
                             onerror="this.onerror=null; this.src='{{ url_for('static', filename='images/placeholder.png') }}'">
                    </div>
                    <div class="order-product-info">
                        <h3 class="order-product-name">{{ item['name_' + lang_code] }}</h3>
                        {% if item['description_' + lang_code] %}
                            <p class="order-product-description">{{ item['description_' + lang_code] }}</p>
                        {% endif %}
                        {% if item['allergens_' + lang_code] %}
                            <p class="order-product-allergens">
                                {{ _('Allergens') }}: {{ item['allergens_' + lang_code] }}
                            </p>
                        {% endif %}
                        <p class="order-product-price">{{ _('Price') }}: {{ "%.2f"|format(item.price) }} {{ _('PLN') }}</p>
                        <div class="order-quantity-control">
                            <button class="decrease-quantity" data-item-id="{{ item.item_id }}" disabled>-</button>
                            <span class="quantity" data-item-id="{{ item.item_id }}">0</span>
                            <button class="increase-quantity" data-item-id="{{ item.item_id }}" disabled>+</button>
                        </div>
                        <p class="order-item-total" data-item-id="{{ item.item_id }}">
                            {{ _('Total') }}: {{ "%.2f"|format(0.00) }} {{ _('PLN') }}
                        </p>
                    </div>
                </article>
            {% endfor %}
        </div>
    </main>

    <!-- Dolna sekcja -->
    <footer class="order-bottom-section">
        <button id="cancel-order" 
                class="order-action-button order-cancel-button"
                data-confirm-message="{{ _('Are you sure you want to cancel your order?') }}"
                data-success-message="{{ _('Order cancelled successfully') }}"
                data-error-message="{{ _('Failed to cancel order') }}">
            {{ _('Cancel') }}
        </button>
        <button id="proceed-to-summary" 
                class="order-action-button order-total-button"
                data-template="{{ _('Total: %(total).2f %(currency)s', total=0.00, currency=_('PLN')) }}"
                data-empty-cart-message="{{ _('Please add items to your order before proceeding.') }}"
                data-inactivity-message="{{ _('You have been inactive for a while. Do you want to continue your order?') }}">
            {{ _('Total') }}: {{ "%.2f"|format(0.00) }} {{ _('PLN') }}
        </button>
    </footer>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/order.js') }}"></script>
{% endblock %}
