{% extends "base.html" %}

{% block head %}
{{ super() }}
{% endblock %}

{% block content %}
<div class="order-container" data-order-id="{{ order_id }}" data-aps-id="{{ aps_id }}">
    <!-- Górna sekcja (10% wysokości) - OK, ale dodajmy flex-shrink: 0 -->
    <header class="order-top-section">
        <div class="order-logo-section">
            <img src="{{ url_for('static', filename='images/MunchiesLogoPlain.svg') }}" alt="Munchies Logo" class="order-logo">
            <h2 class="order-menu-title">{{ _('Menu') }}</h2>
        </div>
        <div class="order-flags-section">
            <div class="order-flags">
                <button class="order-flag-button">
                    <img src="{{ url_for('static', filename='images/plFlag.png') }}" alt="pl" class="order-flag-icon">
                </button>
                <button class="order-flag-button">
                    <img src="{{ url_for('static', filename='images/angFlag.png') }}" alt="en" class="order-flag-icon">
                </button>
                <button class="order-flag-button">
                    <img src="{{ url_for('static', filename='images/uaFlag.png') }}" alt="uk" class="order-flag-icon">
                </button>
            </div>
            <p class="order-estimated-time">
                {{ _('Estimated waiting time: %(time)d min', time=estimated_waiting_time) }}
            </p>
        </div>
    </header>

    <!-- Środkowa sekcja (80% wysokości) - Dodajmy flex-grow: 1 -->
    <main class="order-middle-section">
        <!-- Pasek kategorii - Dodajmy position: sticky -->
        <nav class="order-category-bar">
            {% for category in ['snack', 'drink', 'coffee', 'take_away_box', 'sauce', 'sum'] %}
                <button class="order-category-button {% if loop.first %}active{% endif %}" data-category="{{ category }}">
                    {{ _(category) }}
                </button>
            {% endfor %}
        </nav>

        <!-- Lista produktów - Dodajmy overflow-y: auto -->
        <div class="order-product-list">
            {% for item in menu_items %}
                <article class="order-product-item" data-category="{{ item.category.value }}" data-item-id="{{ item.item_id }}">
                    <div class="order-product-image-container">
                        <img src="" 
                             data-image-filename="{{ item.image }}"
                             alt="{{ item['name_' + session.get('language', 'pl')] }}" 
                             class="order-product-image">
                    </div>
                    <div class="order-product-info">
                        <h3 class="order-product-name">{{ item['name_' + session.get('language', 'pl')] }}</h3>
                        <p class="order-product-description">{{ item['description_' + session.get('language', 'pl')] }}</p>
                        {% if item['allergens_' + session.get('language', 'pl')] %}
                            <p class="order-product-allergens">
                                {{ _('Allergens: ') }}{{ item['allergens_' + session.get('language', 'pl')] }}
                            </p>
                        {% endif %}
                        <p class="order-product-price">{{ _('Price: %(price).2f', price=item.price) }}</p>
                        <div class="order-quantity-control">
                            <button class="decrease-quantity" data-item-id="{{ item.item_id }}" disabled>-</button>
                            <span class="quantity" data-item-id="{{ item.item_id }}">0</span>
                            <button class="increase-quantity" data-item-id="{{ item.item_id }}" disabled>+</button>
                        </div>
                        <p class="order-item-total" data-item-id="{{ item.item_id }}">
                            {{ _('Total: %(total).2f', total=0.00) }}
                        </p>
                    </div>
                </article>
            {% endfor %}
        </div>
    </main>

    <!-- Dolna sekcja (10% wysokości) - OK, ale dodajmy flex-shrink: 0 -->
    <footer class="order-bottom-section">
        <button id="cancel-order" 
                class="order-action-button order-cancel-button"
                data-confirm-message="{{ _('Are you sure you want to cancel your order?') }}"
                data-success-message="{{ _('Order cancelled successfully') }}"
                data-error-message="{{ _('Failed to cancel order') }}">
            {{ _('Cancel') }}
        </button>
        <button id="proceed-to-summary" 
                class="order-action-button order-total-button"
                data-template="{{ _('Total: %(total).2f', total=0.00) }}"
                data-empty-cart-message="{{ _('Please add items to your order before proceeding.') }}"
                data-inactivity-message="{{ _('You have been inactive for a while. Do you want to continue your order?') }}">
            {{ _('Total: %(total).2f', total=0.00) }}
        </button>
    </footer>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/order.js') }}"></script>
{% endblock %}
